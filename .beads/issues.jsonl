{"id":"bd-eye-06a","title":"Support Dolt databases alongside SQLite","description":"Detect whether the backing store is a Dolt database or SQLite and use the appropriate driver.\n\n## Context\n\nbd-eye currently assumes a SQLite database via better-sqlite3 (synchronous, readonly WAL mode). Beads itself supports Dolt as a backend. bd-eye should be able to read from either.\n\n## Detection strategy\n\n- If the resolved path is a directory containing a `.dolt` subdirectory, treat as Dolt\n- If the resolved path is a `.db` file, treat as SQLite\n- The `BEADS_DB` env var and auto-discovery logic in `resolveDbPath()` already resolve to a path — detection layers on top of that\n\n## Implementation plan\n\n### 1. Make the Db interface async\n\nThe `Db` typedef in `src/server/db.js` (line 41-53) currently returns synchronous values. All methods need to return `Promise<T>` to support both sync (better-sqlite3) and async (mysql2) drivers.\n\n**Files affected:**\n- `src/server/db.js` — change typedef, wrap better-sqlite3 calls in `Promise.resolve()` or use `async` functions\n- `src/server/routes/issues.js` — add `await` to every `db.*()` call, make route handlers `async`\n- `src/server/index.js` — `await openDb()` at startup\n\n### 2. Extract SQLite implementation\n\nMove the current better-sqlite3 implementation into `src/server/db-sqlite.js`, exporting a function with the same `openDb` signature that returns a `Db`.\n\n### 3. Create Dolt implementation\n\nNew file `src/server/db-dolt.js`:\n- Connect to Dolt SQL server via `mysql2/promise`\n- Implement the same `Db` interface\n- Connection config from env vars: `DOLT_HOST`, `DOLT_PORT`, `DOLT_USER`, `DOLT_PASSWORD`, `DOLT_DATABASE`\n- The SQL queries are standard and should transfer directly\n- Views `ready_issues` and `blocked_issues` must exist in the Dolt schema (beads creates these)\n\n### 4. Add detection and factory in db.js\n\n`src/server/db.js` becomes a thin dispatcher:\n- `resolveDbPath()` — unchanged\n- `detectDbType(path)` — returns `'sqlite' | 'dolt'` based on path characteristics\n- `openDb(path)` — calls the appropriate implementation\n\n### 5. Adapt the file watcher\n\n`src/server/watcher.js` currently watches SQLite WAL/SHM files via chokidar. For Dolt:\n- Option A: Poll `DOLT_LOG()` or `HASHOF('HEAD')` on an interval to detect commits\n- Option B: Watch the `.dolt/noms` directory for file changes\n- Extract a `createWatcher(dbType, path, onChange)` factory\n\n### 6. Update configuration\n\n- Add new env vars to `.env.example`: `DOLT_HOST`, `DOLT_PORT`, `DOLT_USER`, `DOLT_PASSWORD`, `DOLT_DATABASE`\n- Update README with Dolt setup instructions\n- Add `mysql2` as an optional/peer dependency\n\n## Key risks\n\n- The sync-to-async migration touches every route handler — keep the diff minimal by making SQLite impl async too\n- Dolt SQL server must be running separately — document this clearly\n- Views (`ready_issues`, `blocked_issues`) must exist in Dolt — verify beads creates them for Dolt backends","status":"closed","priority":2,"issue_type":"feature","owner":"daniel.chicot@dlapiper.com","created_at":"2026-02-15T16:50:54Z","created_by":"Daniel Chicot","updated_at":"2026-02-15T17:19:41Z","closed_at":"2026-02-15T17:19:41Z","work_type":"mutex"}
{"id":"bd-eye-7jb","title":"Add test suite with 85% minimum coverage","description":"The project currently has zero tests. Add a comprehensive test suite targeting at least 85% code coverage.\n\n## Scope\n\nServer-side code in src/server/:\n\n- **db.js**: detectDbType() path classification (sqlite vs dolt), resolveDbPath() env var / auto-discovery / fallback behaviour, openDb() factory dispatching\n- **db-sqlite.js**: All Db interface methods (allIssues, issueById, readyIssues, blockedIssues, dependenciesFor, epics, epicChildren, labels, commentsFor, allLabels, searchIssues, close) against a temp SQLite database\n- **db-dolt.js**: Same Db interface methods — will need a mock or integration test against a real Dolt SQL server\n- **routes/issues.js**: Response shapes, query param filtering, 404 handling, label attachment via attachLabels()\n- **watcher.js**: createWatcher() factory dispatching, SQLite watcher triggers on file change, Dolt watcher polls and detects hash changes\n- **index.js**: Startup wiring (may be covered by integration tests)\n\n## Approach\n\n- Pick a test runner (vitest recommended — fast, ESM-native, built-in coverage via c8/v8)\n- Use parameterized tests where possible\n- Use a temp SQLite database for db-sqlite and route tests\n- Mock mysql2/promise for db-dolt unit tests\n- Add npm scripts: test, test:coverage\n- Configure coverage thresholds: 85% minimum for lines, branches, functions, statements\n- Add coverage config to vitest.config.js or package.json","status":"closed","priority":2,"issue_type":"task","owner":"daniel.chicot@dlapiper.com","created_at":"2026-02-15T17:38:53Z","created_by":"Daniel Chicot","updated_at":"2026-02-15T18:39:23Z","closed_at":"2026-02-15T18:39:23Z","close_reason":"99 tests, 94.87% branch coverage, squash-merged via PR #2"}
{"id":"bd-eye-8","title":"Multi-board navigation with project switcher dropdown","description":"Add ability to discover multiple beads projects under ~/workspace, serve them all from a single server with per-board connections, and provide a nav bar dropdown to switch between boards. URL format: #/:boardName/view. Config stored in ~/.bd-eye.json.","status":"closed","priority":2,"issue_type":"feature","owner":"steve.risdon@dlapiper.com","created_at":"2026-02-18T08:24:38.823509Z","created_by":"Steve Risdon","updated_at":"2026-02-18T08:39:20.197725Z","closed_at":"2026-02-18T08:39:20.197725Z","close_reason":"Implemented multi-board navigation with auto-discovery, per-board connections, nav dropdown, URL routing"}
